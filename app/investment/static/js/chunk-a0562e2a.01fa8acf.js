(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a0562e2a"],{7237:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n("d225"),o=n("b0b4"),i=n("4398"),l=n("83d6"),r=n.n(l),s=n("5f87"),c=n("ed08"),u=(r.a.neo4j,function(){function e(t){Object(a["a"])(this,e),this.initNeo4j()}return Object(o["a"])(e,[{key:"initNeo4j",value:function(){var e=JSON.parse(Object(s["a"])());this.database=e.database,this.driver=i["driver"](e.bolt,i["auth"].basic(e.username,e.password))}},{key:"runCypher",value:function(e,t,n){console.log("Cypehr 请求："),console.log(e),console.log(t);var a=this,o=new Promise((function(o,l){a.driver||l("Neo4j driver 没有初始化");var r=a.driver.session({database:a.database,defaultAccessMode:i["session"].WRITE});r.run(e,t).then((function(e){if(console.log("结果："),console.log(e),n)switch(n){case c["a"]:e=Object(c["l"])(e);break;case c["f"]:e=Object(c["r"])(e);break;case c["e"]:e=Object(c["p"])(e);break;case c["d"]:e=Object(c["o"])(e);break;case c["b"]:e=Object(c["m"])(e);break;case c["c"]:e=Object(c["n"])(e);break;case c["g"]:e=Object(c["q"])(e);break;default:}console.log("转换结果类型后："),console.log(e),o(e)})).catch((function(e){l(e)})).then((function(){return r.close()}))}));return o}}]),e}())},9406:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"dashboard-container",staticStyle:{"min-height":"calc(100vh - 115px)"}},[n("el-row",[n("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:e.showConditionDia}},[e._v("条件查找")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:e.showPahtDia}},[e._v("路径查找")]),e._v(" "),e._l(e.config.queries,(function(t,a){return n("el-button",{key:a,attrs:{type:"primary",size:"mini",round:""},on:{click:function(n){return e.showCustomDia(t)}}},[e._v(e._s(t.name))])}))],2),e._v(" "),n("svg",{attrs:{id:"svg-graph",width:e.svg_width,height:e.svg_height}}),e._v(" "),e.tableData.length>0?n("table",{attrs:{id:"tempTable",border:"1px",cellspacing:"0",cellpadding:"0"}},[e._m(0),e._v(" "),e._l(e.tableData,(function(t){return n("tr",{key:t.key},[n("td",{staticClass:"td1"},[e._v(e._s(t.name))]),e._v(" "),n("td",{staticClass:"td2"},["url"==t.valType&&t.val?n("a",{attrs:{target:"_blank",href:t.val}},[e._v("查看")]):"img"==t.valType&&t.val?n("img",{attrs:{src:t.val,width:"200"}}):n("span",[e._v(" "+e._s(t.val)+"  ")])])])}))],2):e._e(),e._v(" "),n("el-dialog",{attrs:{title:"条件查找",visible:e.conditionDiaVisible},on:{"update:visible":function(t){e.conditionDiaVisible=t}}},[n("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.activeTabName,callback:function(t){e.activeTabName=t},expression:"activeTabName"}},[n("el-tab-pane",{attrs:{label:"节点",name:"first"}},[n("b",[e._v("添加条件："),n("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:""},on:{click:function(t){return e.conditionQuery.conditions.push({})}}})],1),e._v(" "),e._l(e.conditionQuery.conditions,(function(t,a){return n("div",{key:a,attrs:{label:"属性",prop:"props"}},[n("p",[e._v("条件"+e._s(a+1)+"：\n            "),n("el-button",{staticStyle:{float:"right"},attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:""},on:{click:function(t){return e.conditionQuery.conditions.splice(a,1)}}})],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:4}},[n("el-select",{attrs:{placeholder:"节点"},on:{change:function(n){return e.changeNodePropertyModel(t)}},model:{value:t.label,callback:function(n){e.$set(t,"label",n)},expression:"conditionItem.label"}},e._l(e.config.nodes,(function(e){return n("el-option",{key:e.labels[0],attrs:{label:e.name,value:e.labels[0]}})})),1)],1),e._v(" "),n("el-col",{attrs:{span:8}},[n("el-select",{attrs:{placeholder:"属性名"},on:{change:function(n){return e.changeNodePropertyModel(t)}},model:{value:t.property,callback:function(n){e.$set(t,"property",n)},expression:"conditionItem.property"}},e._l(e.getNodePropertiesWithLabel(t.label),(function(e,t){return n("el-option",{key:t,attrs:{label:e.name,value:e.key}})})),1)],1),e._v(" "),n("el-col",{attrs:{span:4}},[n("el-select",{attrs:{placeholder:"运算符"},model:{value:t.operator,callback:function(n){e.$set(t,"operator",n)},expression:"conditionItem.operator"}},e._l(e.operators,(function(e){return n("el-option",{key:e.name,attrs:{label:e.name,value:e.val}})})),1)],1),e._v(" "),n("el-col",{attrs:{span:8}},[t&&"datetime"==t.valType?n("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"选择日期时间"},model:{value:t.val,callback:function(n){e.$set(t,"val",n)},expression:"conditionItem.val"}}):t&&"select"==t.valType?n("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.val,callback:function(n){e.$set(t,"val",n)},expression:"conditionItem.val"}},e._l(t.options,(function(e){return n("el-option",{key:e.val,attrs:{label:e.name,value:e.val}})})),1):t&&"number"==t.valType?n("el-input",{attrs:{type:"number"},model:{value:t.val,callback:function(n){e.$set(t,"val",n)},expression:"conditionItem.val"}}):t&&"string"==t.valType?n("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.association,placeholder:"请输入内容","trigger-on-focus":!1},on:{focus:function(n){return e.conditionQueryassociationFocus(t)}},model:{value:t.val,callback:function(n){e.$set(t,"val",n)},expression:"conditionItem.val"}}):n("el-input",{model:{value:t.val,callback:function(n){e.$set(t,"val",n)},expression:"conditionItem.val"}})],1)],1)],1)}))],2),e._v(" "),n("el-tab-pane",{attrs:{label:"关系",name:"second"}},[n("b",[e._v("添加条件："),n("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:""},on:{click:function(t){return e.conditionQuery.conditions.push({})}}})],1),e._v(" "),e._l(e.conditionQuery.conditions,(function(t,a){return n("div",{key:a,attrs:{label:"属性",prop:"props"}},[n("p",[e._v("条件"+e._s(a+1)+"：\n            "),n("el-button",{staticStyle:{float:"right"},attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:""},on:{click:function(t){return e.conditionQuery.conditions.splice(a,1)}}})],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:4}},[n("el-select",{attrs:{placeholder:"关系"},on:{change:function(n){return e.changeRelPropertyModel(t)}},model:{value:t.type,callback:function(n){e.$set(t,"type",n)},expression:"conditionItem.type"}},e._l(e.config.rels,(function(e){return n("el-option",{key:e.type,attrs:{label:e.name,value:e.type}})})),1)],1),e._v(" "),n("el-col",{attrs:{span:8}},[n("el-select",{attrs:{placeholder:"属性名"},on:{change:function(n){return e.changeRelPropertyModel(t)}},model:{value:t.property,callback:function(n){e.$set(t,"property",n)},expression:"conditionItem.property"}},e._l(e.getRelPropertiesWithType(t.type),(function(e,t){return n("el-option",{key:t,attrs:{label:e.name,value:e.key}})})),1)],1),e._v(" "),n("el-col",{attrs:{span:4}},[n("el-select",{attrs:{placeholder:"运算符"},model:{value:t.operator,callback:function(n){e.$set(t,"operator",n)},expression:"conditionItem.operator"}},e._l(e.operators,(function(e){return n("el-option",{key:e.name,attrs:{label:e.name,value:e.val}})})),1)],1),e._v(" "),n("el-col",{attrs:{span:8}},[t&&"datetime"==t.valType?n("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"选择日期时间"},model:{value:t.val,callback:function(n){e.$set(t,"val",n)},expression:"conditionItem.val"}}):t&&"select"==t.valType?n("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.val,callback:function(n){e.$set(t,"val",n)},expression:"conditionItem.val"}},e._l(t.options,(function(e){return n("el-option",{key:e.val,attrs:{label:e.name,value:e.val}})})),1):t&&"number"==t.valType?n("el-input",{attrs:{type:"number"},model:{value:t.val,callback:function(n){e.$set(t,"val",n)},expression:"conditionItem.val"}}):t&&"string"==t.valType?n("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.association,placeholder:"请输入内容","trigger-on-focus":!1},on:{focus:function(n){return e.conditionQueryassociationFocus(t)}},model:{value:t.val,callback:function(n){e.$set(t,"val",n)},expression:"conditionItem.val"}}):n("el-input",{model:{value:t.val,callback:function(n){e.$set(t,"val",n)},expression:"conditionItem.val"}})],1)],1)],1)}))],2)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.conditionDiaVisible=!1}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.conditionDiaVisible=!1,e.loadList(e.conditionQuery)}}},[e._v("确定")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:e.currentCustomQueryModel.name,visible:e.showCustomDiaVisible,"append-to-body":""},on:{"update:visible":function(t){e.showCustomDiaVisible=t}}},[n("el-form",{ref:"customQueryForm",attrs:{rules:e.customQueryFormRules,model:e.customQuery,"label-position":"left","label-width":"80px"}},e._l(e.currentCustomQueryModel.properties,(function(t){return n("el-form-item",{key:t.key,attrs:{label:t.name,prop:t.key}},[t.isArray?n("div",[n("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:""},on:{click:function(n){e.customQuery[t.key].push(""),e.$forceUpdate()}}}),e._v(" "),e._l(e.customQuery[t.key],(function(a,o){return n("div",{key:o},[e._v("\n                "+e._s(t.name+(o+1))+" : \n                  "),"datetime"==t.valType?n("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"选择日期时间"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.customQuery[t.key][o],callback:function(n){e.$set(e.customQuery[t.key],o,n)},expression:"customQuery[item.key][index]"}}):"select"==t.valType?n("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.customQuery[t.key][o],callback:function(n){e.$set(e.customQuery[t.key],o,n)},expression:"customQuery[item.key][index]"}},e._l(t.options,(function(e){return n("el-option",{key:e.val,attrs:{label:e.name,value:e.val}})})),1):"number"==t.valType?n("el-input",{attrs:{type:"number"},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.customQuery[t.key][o],callback:function(n){e.$set(e.customQuery[t.key],o,n)},expression:"customQuery[item.key][index]"}}):t.association?n("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.association,placeholder:"请输入内容","trigger-on-focus":!1},on:{focus:function(n){return e.customQueryassociationFocus(t)},input:function(t){return e.$forceUpdate()}},model:{value:e.customQuery[t.key][o],callback:function(n){e.$set(e.customQuery[t.key],o,n)},expression:"customQuery[item.key][index]"}}):n("el-input",{on:{input:function(t){return e.$forceUpdate()}},model:{value:e.customQuery[t.key][o],callback:function(n){e.$set(e.customQuery[t.key],o,n)},expression:"customQuery[item.key][index]"}})],1)}))],2):n("div",["datetime"==t.valType?n("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"选择日期时间"},model:{value:e.customQuery[t.key],callback:function(n){e.$set(e.customQuery,t.key,n)},expression:"customQuery[item.key]"}}):"select"==t.valType?n("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.customQuery[t.key],callback:function(n){e.$set(e.customQuery,t.key,n)},expression:"customQuery[item.key]"}},e._l(t.options,(function(e){return n("el-option",{key:e.val,attrs:{label:e.name,value:e.val}})})),1):"number"==t.valType?n("el-input",{attrs:{type:"number"},model:{value:e.customQuery[t.key],callback:function(n){e.$set(e.customQuery,t.key,n)},expression:"customQuery[item.key]"}}):t.association?n("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.association,placeholder:"请输入内容","trigger-on-focus":!1},on:{focus:function(n){return e.customQueryassociationFocus(t)}},model:{value:e.customQuery[t.key],callback:function(n){e.$set(e.customQuery,t.key,n)},expression:"customQuery[item.key]"}}):n("el-input",{model:{value:e.customQuery[t.key],callback:function(n){e.$set(e.customQuery,t.key,n)},expression:"customQuery[item.key]"}})],1)])})),1),e._v(" "),n("p",[e._v(e._s(e.currentCustomQueryModel.remark))]),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showCustomDiaVisible=!1}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.doCustomQuery()}}},[e._v("确定")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"路径搜索",visible:e.pathDiaVisible,"append-to-body":""},on:{"update:visible":function(t){e.pathDiaVisible=t}}},[n("el-form",{ref:"dataForm",attrs:{model:e.pathQuery,"label-position":"left","label-width":"80px"}},[n("el-form-item",{attrs:{label:"起始节点"}},[n("el-button",{attrs:{type:"primary",round:""},on:{click:e.doSelectPathStart}},[e._v("选择")]),e._v("\n            "+e._s(e.pathQuery.startNode?e.pathQuery.startNode.name:"")+"\n          ")],1),e._v(" "),n("el-form-item",{attrs:{label:"终止节点"}},[n("el-button",{attrs:{type:"primary",round:""},on:{click:e.doSelectPathEnd}},[e._v("选择")]),e._v("\n            "+e._s(e.pathQuery.endNode?e.pathQuery.endNode.name:"")+"\n          ")],1),e._v(" "),n("el-form-item",{attrs:{label:"路径深度"}},[n("el-input",{staticStyle:{width:"90px"},attrs:{type:"number",placeholder:"最小值"},model:{value:e.pathQuery.min,callback:function(t){e.$set(e.pathQuery,"min",t)},expression:"pathQuery.min"}}),e._v("\n            —\n            "),n("el-input",{staticStyle:{width:"90px"},attrs:{type:"number",placeholder:"最大值"},model:{value:e.pathQuery.max,callback:function(t){e.$set(e.pathQuery,"max",t)},expression:"pathQuery.max"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"路径类型"}},[n("el-radio",{attrs:{label:1},model:{value:e.pathQuery.type,callback:function(t){e.$set(e.pathQuery,"type",t)},expression:"pathQuery.type"}},[e._v("最短路径")]),e._v(" "),n("el-radio",{attrs:{label:2},model:{value:e.pathQuery.type,callback:function(t){e.$set(e.pathQuery,"type",t)},expression:"pathQuery.type"}},[e._v("全部路径")]),e._v("（结果集巨大慎用）\n          ")],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.pathDiaVisible=!1}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.doPathQuery()}}},[e._v("确定")])],1)],1)],1)},o=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("tr",{staticStyle:{background:"#409EFF"}},[n("td",{staticClass:"td1"},[e._v("属性名")]),e._v(" "),n("td",{staticClass:"td2"},[e._v("值")])])}],i=(n("7f7f"),n("7514"),n("ac6a"),n("bd86")),l=n("7237"),r=n("ed08"),s=new l["a"];s.loadQuery=function(e){return this.runCypher(e,null,r["d"])},s.association=function(e,t){var n="";return n="node"==e.nodeOrRel?"MATCH (N"+(e.label?":"+e.label:"")+") WHERE N."+e.property+"=~'.*"+t+".*' RETURN N."+e.property+" LIMIT 10":"MATCH ()-[R"+(e.type?":"+e.type:"")+"]-() WHERE R."+e.property+"=~'.*"+t+".*' RETURN R."+e.property+" LIMIT 10",this.runCypher(n,null,r["c"])},s.all=function(e){if(e){var t="";if("node"==e.nodeOrRel){var n="";e.conditions.forEach((function(e){if(null!=e.operator&&null!=e.property&&null!=e.val){var t="";e.label&&(t="'"+e.label+"' IN labels(O)  AND "),"like"==e.operator?n+=" ( "+t+" O."+e.property+"=~'.*"+e.val+".*') AND ":n+=" ("+t+" O."+e.property+e.operator+Object(r["i"])(e.valType,e.val)+") AND "}})),n=n.length>0?" WHERE "+n.substring(0,n.length-4):"",t="MATCH (O) "+n+" RETURN O"}else{var a="";e.conditions.forEach((function(e){if(null!=e.operator&&null!=e.property&&null!=e.val){var t="";e.type&&(t=" type(O)='"+e.type+"' AND "),"like"==e.operator?a+=" ( "+t+" O."+e.property+"=~'.*"+e.val+".*') AND ":a+=" ("+t+" O."+e.property+e.operator+Object(r["i"])(e.valType,e.val)+") AND "}})),a=a.length>0?" WHERE "+a.substring(0,a.length-4):"",t="MATCH (N)-[O]-(M)  "+a+" RETURN N,O,M"}return this.runCypher(t,null,r["d"])}return this.runCypher(" MATCH (N) optional match ()-[R]-() RETURN  N,R ",null,r["d"])},s.relevant=function(e){return this.runCypher(" MATCH (N)-[R]-(M)  WHERE id(N)=$id  RETURN R,M ",e,r["d"])},s.customQuery=function(e,t){var n=Object(r["v"])(e,t),a=e.resultType?e.resultType:r["d"];return this.runCypher(n,t,a)},s.pathQuery=function(e){var t="",n="";return(e.min||e.max)&&(n=".."),e.min&&(n=e.min+n),e.max&&(n+=e.max),1==e.type?(t+="MATCH path=allShortestPaths((start)-[rels *"+n+"]-(end)) ",t+=" where id(start)="+e.startNode.id+" and id(end)="+e.endNode.id,t+=" RETURN nodes(path) AS nodes,relationships(path) AS rels"):(t+="MATCH path=(start)-[rels *"+n+"]-(end) ",t+=" where id(start)="+e.startNode.id+" and id(end)="+e.endNode.id,t+=" RETURN nodes(path) AS nodes,relationships(path) AS rels"),this.runCypher(t,null,r["b"])};var c=s,u=n("5698"),d=(n("5c96"),{name:"Dashboard",data:function(){var e;return e={config:null,svg_width:960,svg_height:500,d3:{data:{links:[],nodes:[]},svg:null,simulation:null,svg_links:null,svg_node_text:null,svg_link_text:null}},Object(i["a"])(e,"config",null),Object(i["a"])(e,"tableData",{}),Object(i["a"])(e,"activeTabName","first"),Object(i["a"])(e,"operators",[{val:"like",name:"类似"},{val:"=",name:"等于"},{val:"<",name:"小于"},{val:">",name:"大于"},{val:"<=",name:"小于等于"},{val:">=",name:"大于等于"}]),Object(i["a"])(e,"conditionDiaVisible",!1),Object(i["a"])(e,"associationQuery",{nodeOrRel:null,property:null,label:null,type:null}),Object(i["a"])(e,"conditionQuery",{nodeOrRel:null,conditions:[{type:null,label:null,operator:null,property:null}]}),Object(i["a"])(e,"showCustomDiaVisible",!1),Object(i["a"])(e,"currentCustomQueryModel",{}),Object(i["a"])(e,"customQueryFormRules",{}),Object(i["a"])(e,"customQuery",{}),Object(i["a"])(e,"pathDiaVisible",!1),Object(i["a"])(e,"isSelectPathStart",!1),Object(i["a"])(e,"isSelectPathend",!1),Object(i["a"])(e,"pathQuery",{type:1,max:null,min:null,startNode:null,endNode:null}),e},created:function(){this.config=this.$store.state.settings.config},mounted:function(){this.initD3(),this.config.defaultQuery?this.loadDefaultQuery():this.loadList()},methods:{loadDefaultQuery:function(){var e=this;c.loadQuery(this.config.defaultQuery.cypher).then((function(t){e.cleanD3(),e.d3.data=t,e.loadD3(e.d3.data)}))},loadList:function(e){var t=this;c.all(e).then((function(e){t.cleanD3(),t.d3.data=e,t.loadD3(t.d3.data)}))},getRelevant:function(e){var t=this;c.relevant(e).then((function(e){e.nodes.forEach((function(e){0==t.d3.data.nodes.filter((function(t){return t.id==e.id})).length&&t.d3.data.nodes.push(e)})),e.links.forEach((function(e){0==t.d3.data.links.filter((function(t){return t.id==e.id})).length&&t.d3.data.links.push(e)})),t.loadD3(t.d3.data)}))},showConditionDia:function(){this.conditionDiaVisible=!0,this.handleTabClick()},conditionQueryassociationFocus:function(e){this.associationQuery.nodeOrRel=this.conditionQuery.nodeOrRel,this.associationQuery.property=e.property,this.associationQuery.label=e.label,this.associationQuery.type=e.type},customQueryassociationFocus:function(e){this.associationQuery=e.association},association:function(e,t){c.association(this.associationQuery,e).then((function(e){var n=[];e.forEach((function(e){n.push({value:e})})),t(n)}))},handleTabClick:function(){this.associationQuery={nodeOrRel:null,property:null,label:null,type:null};var e=null,t=null,n=null,a=null;"first"==this.activeTabName?(a="node",e=this.config.nodes[0].labels[0],n=this.config.nodes[0].properties[0].key,this.conditionQuery={nodeOrRel:a,conditions:[{type:t,label:e,operator:"=",property:n}]},this.changeNodePropertyModel(this.conditionQuery.conditions[0])):(a="rel",t=this.config.rels[0].type,this.config.rels[0].properties[0]&&(n=this.config.rels[0].properties[0].key),this.conditionQuery={nodeOrRel:a,conditions:[{type:t,label:e,operator:"=",property:n}]},this.changeRelPropertyModel(this.conditionQuery.conditions[0]))},getNodePropertiesWithLabel:function(e){var t=this.config.nodes.find((function(t){return-1!=t.labels.indexOf(e)}));return t?t.properties:null},changeNodePropertyModel:function(e){var t=this.getNodePropertiesWithLabel(e.label);if(t){var n=t.find((function(t){return t.key==e.property}));n?(e.valType=n.valType,e.options=n.options):(e.valType=null,e.options=null)}},getRelPropertiesWithType:function(e){var t=this.config.rels.find((function(t){return t.type==e}));return t?t.properties:null},changeRelPropertyModel:function(e){var t=this.getRelPropertiesWithType(e.type);if(t){var n=t.find((function(t){return t.key==e.property}));n?(e.valType=n.valType,e.options=n.options):(e.valType=null,e.options=null)}},showCustomDia:function(e){var t=this;this.currentCustomQueryModel=e,this.customQuery={},e.properties.forEach((function(e){t.customQueryFormRules[e.key]=[{required:!0,message:"请输入"+e.name,trigger:"blur"}],e.isArray&&(t.customQuery[e.key]=[])})),this.showCustomDiaVisible=!0},doCustomQuery:function(){var e=this;this.$refs["customQueryForm"].validate((function(t){t&&c.customQuery(e.currentCustomQueryModel,e.customQuery).then((function(t){e.showCustomDiaVisible=!1,e.cleanD3(),e.d3.data=t,e.loadD3(e.d3.data)}))}))},showPahtDia:function(){this.pathQuery={type:1,max:null,min:null,startNode:null,endNode:null},this.pathDiaVisible=!0},doSelectPathStart:function(){this.isSelectPathEnd=!1,this.isSelectPathStart=!0,this.pathDiaVisible=!1},doSelectPathEnd:function(){this.isSelectPathStart=!1,this.isSelectPathEnd=!0,this.pathDiaVisible=!1},doPathQuery:function(){var e=this;null!=this.pathQuery.startNode&&null!=this.pathQuery.endNode?c.pathQuery(this.pathQuery).then((function(t){e.isSelectPathStart=!1,e.isSelectPathEnd=!1,e.pathDiaVisible=!1,e.cleanD3(),e.d3.data=t,e.loadD3(e.d3.data)})):this.$message.error("请先选择起始、终止检点")},initD3:function(){this.d3.svg=u["i"]("#svg-graph");var e=this.d3.svg.attr("width"),t=this.d3.svg.attr("height"),n=this.$refs["dashboard-container"];n&&(this.svg_width=n.offsetWidth,this.svg_height=n.offsetHeight,e=n.offsetWidth,t=n.offsetHeight),this.d3.simulation=u["f"]().force("link",u["d"]().distance(200).id((function(e){return e.id}))).force("charge",u["e"]()).force("center",u["c"](e/2,t/2));var a=this.d3.svg.append("g"),o=a.append("g"),i=a.append("g");this.d3.svg_links=o.selectAll("path"),this.d3.svg_link_text=o.selectAll("linktext"),this.d3.svg_nodes=i.selectAll("circle"),this.d3.svg_node_text=i.selectAll("nodetext"),this.d3.svg.call(u["k"]().scaleExtent([.05,8]).on("zoom",(function(){var e=u["b"].transform;a.attr("transform",e)}))).on("dblclick.zoom",null)},cleanD3:function(){u["j"]("#svg-graph > *").remove(),this.initD3()},loadD3:function(e){var t=this,n=e;n.links.forEach((function(e){if(null==e.index)for(var t=n.links.filter((function(t){return t.source==e.source&&t.target==e.target||t.target==e.source&&t.source==e.target})),a=0;a<t.length;a++)t.length%2==0?t[a].rxy=a%2==0?(a+2)/2/t.length/2:t[a-1].rxy:t[a].rxy=0==a?0:a%2!=0?(a+1)/2/(t.length-1)/2:t[a-1].rxy,t[a].sweep=a%2==0?0:1,t[a].link_count=t.length})),this.d3.svg_links=this.d3.svg_links.data(n.links).enter().append("path").on("click",c).style("stroke","#bbb").attr("stroke-width",2).attr("fill","none").merge(this.d3.svg_links),this.d3.svg_link_text=this.d3.svg_link_text.data(n.links).enter().append("text").style("fill","#000000").style("text-anchor","middle").style("cursor","default").style("font-size","12").on("click",c).attr("dominant-baseline","middle").text((function(e){var n=t.config.rels.filter((function(t){return t.type==e.type}));return n.length>0?n[0].name:e.type})).merge(this.d3.svg_link_text);this.d3.svg.append("marker").attr("id","resolved").attr("markerUnits","userSpaceOnUse").attr("viewBox","0 -5 10 10").attr("refX",39).attr("refY",0).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").attr("stroke-width",2).append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#999");var a=u["g"](u["h"]);function o(){t.d3.svg_links.attr("d",(function(e){var t=0;if(0!=e.rxy){var n=h(e.link_count),a=p(e.source.x,e.source.y,e.target.x,e.target.y,n*e.rxy,e.sweep);t=y(e.source.x,e.source.y,e.target.x,e.target.y,a.x,a.y)}return"M"+e.source.x+","+e.source.y+"A"+t+","+t+" 0 0,"+e.sweep+" "+e.target.x+","+e.target.y})).attr("marker-end","url(#resolved)"),t.d3.svg_link_text.attr("transform",(function(e){var t=h(e.link_count),n=p(e.source.x,e.source.y,e.target.x,e.target.y,t*e.rxy,e.sweep);if(e.source.x&&e.source.y&&e.target.x&&e.target.y)return"translate("+n.x+","+n.y+") rotate("+180*Math.atan((e.target.y-e.source.y)/(e.target.x-e.source.x))/Math.PI+")"})),t.d3.svg_nodes.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),t.d3.svg_node_text.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y}))}function i(e){u["b"].active||t.d3.simulation.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function l(e){e.fx=u["b"].x,e.fy=u["b"].y}function s(e){u["b"].active||t.d3.simulation.alphaTarget(0),e.fx=null,e.fy=null}function c(e){t.isSelectPathStart?(t.pathQuery.startNode=e,t.pathDiaVisible=!0):t.isSelectPathEnd&&(t.pathQuery.endNode=e,t.pathDiaVisible=!0);var n=Object.assign({},e);t.tableData=Object(r["h"])(n,t.config)}function d(e){var n=Object.assign({},e);t.getRelevant({id:n.id})}function p(e,t,n,a,o,i){1==i&&(o=-o);var l=-1/((t-a)/(e-n)),r=(e+n)/2,s=(t+a)/2,c=1;t<a&&(c=-1);var u=r+c*o/Math.sqrt(1+l*l),d=s+c*l*o/Math.sqrt(1+l*l);return{x:u,y:d}}function y(e,t,n,a,o,i){var l,r,s,c,u,d;u=2*(n-e),d=2*(a-t),c=n*n-e*e+a*a-t*t,l=2*(o-n),r=2*(i-a),s=o*o-n*n+i*i-a*a;var p=(c*r-s*d)/(u*r-l*d),y=(l*c-s*u)/(l*d-r*u),h=Math.sqrt((p-e)*(p-e)+(y-t)*(y-t));return h}function h(e){var t=0;return t=2==e?40:3==e?80:e<=4?110:e<=6?160:e<=8?240:e<=10?320:400,t}this.d3.svg_nodes=this.d3.svg_nodes.data(n.nodes).enter().append("circle").attr("r",30).attr("fill",(function(e){return a(e.labels[0])})).on("click",c).on("dblclick",d).call(u["a"]().on("start",i).on("drag",l).on("end",s)).merge(this.d3.svg_nodes),this.d3.svg_node_text=this.d3.svg_node_text.data(n.nodes).enter().append("text").style("fill","#ffffff").style("font-size","12").style("pointer-events","none").attr("dominant-baseline","middle").attr("text-anchor","middle").text((function(e){return e.name})).merge(this.d3.svg_node_text),this.d3.simulation.nodes(n.nodes),this.d3.simulation.on("tick",o),this.d3.simulation.force("link").links(n.links),this.d3.simulation.alpha(1).restart()}}}),p=d,y=n("2877"),h=Object(y["a"])(p,a,o,!1,null,null,null);t["default"]=h.exports}}]);